<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<script type="text/javascript">
			window.onload = function() {
				//一开始设置一页有几条
				var number=5;
				function selectUser() {
					//获取页数
					ajax("http://localhost:8080/user/userCounts", "", function(result) {
						//用总条数 / 一页有几条
						// 11 /5 向上取整 3
						var page = Math.ceil(result/number);
						var pages=  document.getElementById("pages");
						for(var i=1;i<=page;i++){
							var button = document.createElement("button");
							button.innerText="第"+i+"页";
							
							pages.appendChild(button);
							button.setAttribute("id",i);
							button.onclick=function(){
								console.log(this.getAttribute("id"));
								getUser(this.getAttribute("id"));
							}
						}
					});
					getUser(1);
				}
				//查询数据
				selectUser();
				function getUser(page){
					//1 *5 -5=0
					var start= page*number-number;
					ajax("http://localhost:8080/user/userList", "start="+start+"&limit="+number, function(result) {
						var obj = JSON.parse(result);
						var table = document.getElementById("table");
						for (var i in obj) {
							var id = obj[i].id;
							var userName = obj[i].userName;
							var passWord = obj[i].passWord;
							var sex = obj[i].sex;
							var email = obj[i].email;
							var detail = obj[i].detail;
							var skill = obj[i].skill;
							var tel = obj[i].tel;
							var tr = document.createElement("tr");
							var td =
								`
								<tr>
									<td>${id}</td>
									<td>${userName}</td>
									<td>${passWord}</td>
									<td>${sex}</td>
									<td>${email}</td>
									<td>${detail}</td>
									<td>${skill}</td>
									<td>${tel}</td>
								</tr>
							`;
							tr.innerHTML = td;
							table.appendChild(tr);
						}
					});
				}


				function ajax(url, sendParam, callBack) {
					var xhr = new XMLHttpRequest();
					xhr.open("POST", url, true);
					//POST提交时需添加请求头“Content-Type”，指定MIME类型
					xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
					xhr.onreadystatechange = function() {
						// readyState == 4说明请求已完成
						if (xhr.readyState == 4) {
							if (xhr.status == 200) {
								var result = xhr.responseText;
								callBack(result);
							}
						}
					}
					xhr.send(sendParam);
				}
			}
		</script>
		<style type="text/css">
			#table tr:nth-of-type(2n) {
				background-color: whitesmoke;
			}

			#table {
				margin: auto;
			}
		</style>
	</head>
	<body>
		<table border="1" id="table">
			<tr>
				<th>id</th>
				<th>userName</th>
				<th>passWord</th>
				<th>sex</th>
				<th>email</th>
				<th>detail</th>
				<th>skill</th>
				<th>tel</th>
			</tr>
			<tfoot>
				<td colspan="7" id="pages">
				<!-- 	<button type="button">第一页</button>
					<button type="button">第一页</button>
					<button type="button">第一页</button> -->
				</td>
			</tfoot>
		</table>
	</body>
</html>
